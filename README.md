# Calculate spin structures on low dimensional flat manifolds

Calculate flat manifolds with or without spin structure in dimensions up to 6.

## Prerequisities

1. The following tools are used to obtain the results:

    - bash: we use some scripting
    - [maxima](https://maxima.sourceforge.io/): needed to work with Clifford algebras
    - [GAP](https://www.gap-system.org/)
    - [CARAT](https://lbfm-rwth.github.io/carat/), available also as GAP package
    - [HAPCryst](https://gap-packages.github.io/hapcryst/) GAP package
2. Change data in `carat-env.sh` to reflect the GAP and CARAT setup. Import the variables to the session:

    ```bash
    source carat-env.sh
    ```

## Step 1: Preparing the data for all Bieberbach groups

1. Get the names of the files holding representatives of $\mathbb{Q}$-classes of finite subgroups of $\operatorname{GL}_n(\mathbb{Z})$, for $n \leq 6$, using shell. The output is stored in `qnames.g` file.

    ```bash
    # bash
    ./qnames.sh
    ```

1. Generate the data for further calculations with GAP and CARAT. We store as many information as one can get from $\mathbb{Q}$-class:

    - dimension
    - generators
    - order
    - presentation (from CARAT)
    - orientability

    ```gap
    # gap
    Read( "code.g" );
    # function accepts two arguments, by default: qnames.g, qdata.g
    # it reads qnames.g and writes output to qdata.g
    qdata := ParseQData();;
    # write each record into carat format (group and presentation files)
    # note that the scond argument must point to an empty folder
    WritaCaratQData( qdata, "/tmp/data" );
    ```
1. Filter the groups to those which are holonomies of Bieberbach groups. Side effect of this operation is a generation of Bieberbach groups.

    ```bash
    # bash
    ./qtoz.sh /tmp/data
    ./extensions.sh /tmp/data
    ./anames.sh /tmp/data
    ```

    **Note:** One can check the results by counting number of generated files. Data is taken from [CARAT doc](https://lbfm-rwth.github.io/carat/doc/) website:

    ```bash
    # bash
    find /tmp/data/ -regextype egrep -regex '.*/(group|min|max)\.[0-9]+$' | wc -l                         # number of Q-classes should be 8329
    find /tmp/data/ -regextype egrep -regex '.*/(group|min|max)\.[0-9]+\.[0-9]+\.[0-9]+$' | wc -l         # number of Z-classes should be 92185
    find /tmp/data/ -regextype egrep -regex '.*/(group|min|max)\.[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$' | wc -l # number of Bieberbach groups should be 39893
    ```

    ```gap
    # gap
    # similar as above, the functions accepts two more arguments
    # by default it reads anames.g file and writes to adata.g one
    adata := ParseAffData( qdata );;
    ```

**Note:** At the end of this step, we have two files: 

- `qdata.g` holding information about all $\mathbb{Q}$-classes from CARAT
- `adata.g` holding information about Bieberbach group and their $\mathbb{Q}$-classes

## Step 2: Spin structures for orientable Bieberbach groups with 2-group holonomies

The crucial step is the determination of spin structures on flat manifolds with 2-group holonomy. We are interested in:

- orientable, i.e. those which lie in $\operatorname{SL}(n,\mathbb{Q})$, groups
- of dimension greater than $3$ - up to this dimension all manifolds are spin 

1. Orientable Bieberbach groups with $2$-group holonomy $\mathbb{Q}$-classes of their holonomy groups can be obtained by:

    ```gap
    # gap
    oa2data := Filtered( adata, x->x.qdata.dim>3 and x.qdata.orientable and x.qdata.size>1 and x.qdata.size = 2^Log2Int(x.qdata.size) );;
    oq2data := SSortedList( oa2data, x->x.qdata );;
    ```

1. Now comes the part where we look for lifts of generators of the group. This is done by hand (we can use methods from the article).

1. In order to work with Clifford algebras, we use Maxima. The `run` function involves:

    - checking if the groups lie in $O(n,\mathbb{Z})$ (almost all are)
    - checking whether we generated inverses of elements of $\operatorname{Spin}(n)$
    - checking whether the elements of $\operatorname{Spin}(n)$ are in fact lifts of the generators
    - generating the presentation (a non-trivial part of it) of lift of the holonomy groups

    ```maxima
    /* maxima */
    load( "sdata.mac" );
    load( "scode.mac" );
    run();
    print_to_file( "sdata.g", A );
    ```

## Step 3: Spin structures for low dimensional Bieberbach groups

1. Having proper data from Maxima, we can use GAP to generate the holonomy groups and their lifts to $\operatorname{Spin}(n)$. The `FillSpinQData` function, called by `FillSpinAffData`, will check for consistence of the data generated by Maxima with the data so far calculated by GAP.

    ```gap
    # gap
    sdata := ReadAsFunction( "sdata.g" )();;
    FillSpinAffData( adata, oq2data, sdata );
    ```